var app=angular.module("desafioLaravel",["ui.select","ngSanitize","ui.utils.masks","angularUtils.directives.dirPagination"],["$interpolateProvider",function(e){e.startSymbol("<%"),e.endSymbol("%>")}]);app.filter("propsFilter",function(){return function(e,t){var n=[];if(angular.isArray(e)){var a=Object.keys(t);e.forEach(function(e){for(var r=!1,i=0;i<a.length;i++){var o=a[i],l=t[o].toLowerCase();if(-1!==e[o].toString().toLowerCase().indexOf(l)){r=!0;break}}r&&n.push(e)})}else n=e;return n}}),app.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,n,a){var r=e(a.fileModel),i=r.assign;n.bind("change",function(e){if(t.$apply(function(){void 0===a.multiple?i(t,n[0].files[0]):i(t,n[0].files)}),void 0===a.multiple){var r=new FileReader;r.onload=function(e){t.$apply(function(){t.fileread=e.target.result})},r.readAsDataURL(e.target.files[0])}else t.fileread=[],angular.forEach(e.target.files,function(n,a){var r=new FileReader;r.onload=function(e){t.$apply(function(){t.fileread.push(e.target.result)})},r.readAsDataURL(e.target.files[a])})})}}}]),app.controller("categoriesController",["$rootScope","$scope","$http",function(e,t,n){t.categories=[];var a="/administration/categories/";t.create=function(a,r){a.preventDefault();var i=new FormData;i.append("name",r.name),i.append("file",r.file),t.success=!1,t.error=!1,t.msg=!1,e.loading_el=!0,n.post("/administration/categories/create",i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(n){t.success=!0,t.msg=n.data.return.msg,void 0==e.newCategories&&(e.newCategories=[]),e.newCategories.push(n.data.return.category),t.category={},angular.element(".file").val(null),t.fileread=null,t.categoryForm.$setUntouched(),t.categoryForm.$setPristine()},function(e){t.error=!0,t.msg=response.data.return.msg}).finally(function(){e.loading_el=!1,angular.element("html,body").animate({scrollTop:angular.element("form").offset().top},"slow")})},t.list=function(){n.get(a+"list-all").then(function(e){t.categories=e.data})},t.deleteImage=function(){delete t.category.file,t.fileread=null,angular.element(".file").val(null)},t.chooseDelete=function(e,n,a){e.preventDefault();var r=t.categories.map(function(e){return e.id}).indexOf(a);-1!==r&&(t.categories[r].delete_action=n)},t.delete=function(e,r){e.preventDefault();var i=t.categories.map(function(e){return e.id}).indexOf(r);n.delete(a+"delete/"+r).then(function(e){-1!==i&&(angular.element(".navbar-nav #"+r).remove(),t.categories.splice(i,1))},function(e){console.log(e)})},t.edit=function(r,i,o){t.success=!1,t.error=!1,e.loading_el=!0,t.msg=!1,r.preventDefault();var l=new FormData;l.append("id",o),l.append("name",i.name),void 0!==i.file&&l.append("file",i.file),n.post(a+"edit",l,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(e){t.success=!0,t.msg=e.data.return.msg,t.fileread=null,!1!==e.data.return.file_updated&&angular.element(".image-uploaded").attr("src","/"+e.data.return.file_updated),angular.element(".file").val(null),t.fileread=null},function(e){t.error=!0,t.msg=e.response.data.return.msg}).finally(function(){e.loading_el=!1,angular.element("html,body").animate({scrollTop:angular.element("form").offset().top},"slow")})}}]),app.controller("productsController",["$rootScope","$scope","$http",function(e,t,n){t.categories=[],t.imagesUploaded=[];t.refreshCategories=function(e){n.get("/administration/categories/search/"+e).then(function(e){t.categories=e.data})},t.create=function(a,r){a.preventDefault();var i=new FormData,o="/administration/products/create";if(void 0!==r.id&&(i.append("id",r.id),o="/administration/products/edit"),i.append("name",r.name),i.append("description",r.description),void 0===r.file)i.append("image","");else{i.append("image",r.file[0]);for(var l=1;l<r.file.length;l++)i.append("image"+l,r.file[l]);i.append("imagecount",r.file.length)}i.append("price",r.price);for(var l=0;l<r.categories.length;l++)i.append("categories[]",r.categories[l].id);e.loading_el=!0,n.post(o,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(e){t.success=!0,t.msg=e.data.return.msg,t.imagesUploaded=e.data.return.images,t.fileread=[],void 0===r.id&&(t.product={},angular.element(".file").val(null),t.fileread=null,t.productForm.$setUntouched(),t.productForm.$setPristine())},function(e){t.error=!0,t.msg=e.data.return.msg}).finally(function(){e.loading_el=!1,angular.element("html,body").animate({scrollTop:angular.element("form").offset().top},"slow")})},t.deleteImage=function(e,t,a){e.preventDefault(),n.delete("/administration/products/delimage/"+t.id+"/"+a).then(function(e){angular.element("#"+a).remove()})},t.deleteImageFront=function(e,n,a){e.preventDefault();var r=t.fileread.map(function(e){return e}).indexOf(a);t.fileread.splice(r,1)}}]),app.controller("productListController",["$scope","$http",function(e,t){e.listProducts=function(n){void 0===n&&(n=""),t.get("/administration/products/list/"+n).then(function(t){e.products=t.data.return})},e.startEndDelete=function(t,n,a){t.preventDefault();var r=e.products.map(function(e){return e.id}).indexOf(n.id);-1!==r&&(e.products[r].startDelete=a)},e.delete=function(n,a){n.preventDefault();var r=e.products.map(function(e){return e.id}).indexOf(a.id);e.success=!1,e.error=!1,-1!==r&&t.delete("/administration/products/delete/"+a.id).then(function(t){e.products.splice(r,1),e.success=!0,e.msg=t.data.return},function(t){e.msg=t.data.return,e.error=!0})}}]),app.controller("settingsController",["$rootScope","$scope","$http",function(e,t,n){t.clients=[],t.startDelete=!1;var a="/administration/settings/";n.get(a+"list").then(function(e){t.clients=e.data.return}),t.changeDelete=function(e,n,a){e.preventDefault(),t.clients[n].startDelete=a},t.delete=function(r,i,o){e.loading_el=!0,n.delete(a+"delete/"+i).then(function(){t.clients.splice(o,1)}).finally(function(){e.loading_el=!1})},t.create=function(r,i){r.preventDefault(),e.loading_el=!0,n.post(a+"create",i).then(function(e){e.data.return.client.token=e.data.return.token,t.clients.push(e.data.return.client),console.log(e),t.success=!0,t.msg=e.data.return.msg,t.client={},t.clientForm.$setUntouched(),t.clientForm.$setPristine()},function(e){t.error=!0,void 0!==e.data.return?t.msg=e.data.return.msg:t.msg=e.data.errors}).finally(function(){e.loading_el=!1})}}]);